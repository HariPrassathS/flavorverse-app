<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Test - StarkBites</title>
    <link rel="stylesheet" href="style_theme.css">
</head>
<body>
    <div class="container" style="margin-top: 50px;">
        <h1>Profile System Test</h1>
        
        <div class="card" style="padding: 30px; margin-bottom: 30px;">
            <h2>Quick Login (for Testing)</h2>
            <p>Use these credentials to test the profile system:</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                <div class="info-item">
                    <strong>ðŸšš Delivery Partner:</strong><br>
                    Username: raja_delivery<br>
                    Password: (any or none)
                    <br><br>
                    <button onclick="loginAs('raja_delivery', '')" class="btn btn-success">Login as Delivery</button>
                </div>
                
                <div class="info-item">
                    <strong>ðŸ‘¤ Test Customer:</strong><br>
                    Username: testcustomer<br>
                    Password: password123
                    <br><br>
                    <button onclick="loginAs('testcustomer', 'password123')" class="btn btn-primary">Login as Customer</button>
                </div>

                <div class="info-item">
                    <strong>ðŸ”§ Quick Create:</strong><br>
                    Create new test accounts<br>
                    with known passwords
                    <br><br>
                    <a href="user_manager.html" class="btn btn-secondary">User Manager</a>
                </div>
            </div>

            <div class="password-section" style="margin-top: 30px;">
                <h3>ðŸ”‘ Try Common Test Passwords</h3>
                <p>If you have existing usernames, try these common passwords:</p>
                
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="test-username" placeholder="Enter your username">
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 15px 0;">
                    <button onclick="tryPassword('password')" class="btn btn-secondary">password</button>
                    <button onclick="tryPassword('password123')" class="btn btn-secondary">password123</button>
                    <button onclick="tryPassword('123456')" class="btn btn-secondary">123456</button>
                    <button onclick="tryPassword('admin')" class="btn btn-secondary">admin</button>
                    <button onclick="tryPassword('test')" class="btn btn-secondary">test</button>
                    <button onclick="tryPassword('user')" class="btn btn-secondary">user</button>
                </div>
            </div>
        </div>

        <div class="card" style="padding: 30px;">
            <h2>Test Links</h2>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="customer_profile.html" class="btn btn-primary">Customer Profile</a>
                <a href="admin_profile.html" class="btn btn-secondary">Admin Profile</a>
                <a href="delivery_profile.html" class="btn btn-info">Delivery Profile</a>
                <a href="index.html" class="btn">Home</a>
            </div>
        </div>

        <div id="status" class="message-container" style="display: none; margin-top: 20px;"></div>
    </div>

    <script>
        async function loginAs(username, password) {
            const statusDiv = document.getElementById('status');
            
            try {
                const response = await fetch('/api/users/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password }),
                });

                if (response.ok) {
                    const user = await response.json();
                    sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                    
                    statusDiv.className = 'message-container success';
                    statusDiv.style.display = 'block';
                    statusDiv.textContent = `Logged in successfully as ${user.username} (${user.role})`;
                    
                    // Redirect based on role
                    setTimeout(() => {
                        if (user.role.includes('DELIVERY')) {
                            window.location.href = 'delivery_profile.html';
                        } else if (user.role.includes('ADMIN')) {
                            window.location.href = 'admin_profile.html';
                        } else {
                            window.location.href = 'customer_profile.html';
                        }
                    }, 2000);
                    
                } else {
                    const errorText = await response.text();
                    statusDiv.className = 'message-container error';
                    statusDiv.style.display = 'block';
                    statusDiv.textContent = `Login failed: ${errorText}`;
                }
            } catch (error) {
                statusDiv.className = 'message-container error';
                statusDiv.style.display = 'block';
                statusDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function tryPassword(password) {
            const username = document.getElementById('test-username').value.trim();
            if (!username) {
                alert('Please enter a username first');
                document.getElementById('test-username').focus();
                return;
            }
            
            await loginAs(username, password);
        }

        // Check current login status
        window.addEventListener('load', () => {
            const currentUser = sessionStorage.getItem('loggedInUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                const statusDiv = document.getElementById('status');
                statusDiv.className = 'message-container info';
                statusDiv.style.display = 'block';
                statusDiv.textContent = `Currently logged in as: ${user.username} (${user.role})`;
            }
        });
    </script>
</body>
</html>